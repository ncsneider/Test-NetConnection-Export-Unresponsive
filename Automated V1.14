# Path to CSV containing IP Address information
$inputFile = "$ENV:USERPROFILE\Database.csv"

#Path to directory where CSV output files will be stored 
$logPath = "$ENV:USERPROFILE\Folder Path"

$fullPath = "$logPath\$((Get-Date).Year)\$((Get-Culture).DateTimeFormat.GetMonthName((Get-Date).Month))\$(Get-Date -Format "dd")"#

$ipAddresses = Import-Csv -Path $inputFile

# Creates Year->Month->Day Folder structure
if(!(Test-Path -Path $fullPath -PathType Container))
{
    New-Item -Path $fullPath -ItemType Directory -Force | Out-Null
}

# Cycles through IP's in .CSV file and
$report = Import-Csv -Path $inputFile | ForEach-Object {

    if(!(test-connection -computername $_.IP -quiet -count 1))
    {
        New-Object PsObject -Property @{
            Hostname = $_.Hostname
            "IP Address" = $_.IP
            Location = $_.Location
        }
    }
}

[System.Windows.Forms.MessageBox]::Show('Script has been completed.') | Out-Null

$report | Export-Csv -Path "$fullPath\Unresponsive_IP_Addresses_$(Get-Date -Format "HH-mm-ss").csv" -Force -NoTypeInformation
